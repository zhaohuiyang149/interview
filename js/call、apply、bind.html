<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>callã€applyã€bind çš„åŒºåˆ«</title>
</head>
<body>
    <section>
        <article>
            <h1>applyã€callã€bind çš„å…±åŒç‚¹ï¼š</h1>
            <p>ä¸‰è€…éƒ½æ˜¯ç”¨æ¥æ”¹å˜å‡½æ•°çš„ this å¯¹è±¡çš„æŒ‡å‘ï¼›</p>
            <p>ä¸‰è€…çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ this è¦æŒ‡å‘çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æƒ³æŒ‡å®šçš„ä¸Šä¸‹æ–‡ã€‚</p>
            <p>ä¸‰è€…éƒ½å¯ä»¥åˆ©ç”¨åç»­å‚æ•°ä¼ å‚ã€‚</p>
        </article>
        <article>
            <h1>applyã€callã€bind çš„åŒºåˆ«ï¼š</h1>
            <p>bind æ˜¯è¿”å›å¯¹åº”çš„å‡½æ•°ï¼Œapply å’Œ bind åˆ™æ˜¯ç›´æ¥è°ƒç”¨</p>
            <p>apply çš„è¯­æ³•ï¼ša.fun.apply(b, [parmas1, params2, params3])</p>
            <p>call çš„è¯­æ³•ï¼ša.fun.call(b, params1, params2, params3)</p>
            <p>bind çš„è¯­æ³•ï¼ša.fun.bind(b)(params1, params2, params3) æˆ–è€… a.fun.bind(b, params1, params2, params3)()</p>
        </article>
    </section>
</body>
<script>
    var a = {
        name: 'aa',
        age: 10,
        fun: function (job, place) {
            console.log(this.name, this.age, job, place)
        }
    }
    var b = {
        name: 'bb',
        age: 20
    }
    console.log(a.fun('student', 'beijing'))          // aa 10 student beijing
    console.log(a.fun.apply(b, ['student1', 'shanghai']))       // bb 20 student1 shanghai
    console.log(a.fun.call(b, 'student2', 'henan'))            // bb 20 student2 henan
    console.log(a.fun.bind(b)('student3', 'shenzhen'))         // bb 20 student3 shenzhen

    
    
    var aa = {
        name: 'aaa',
        funa: function (job, age) {
            console.log('åŸç”Ÿ:', this.name + ',' + job + ',' + age)
        }
    }

    function funb (job, age) {
        console.log('call:', this.name + ',' + job + ',' + age)
    }

    // ç”¨åŸç”Ÿjså®ç°call
    Function.prototype.callfun = function () {
        obj = arguments[0] || window
        obj.funb = this
        var arr = []
        for(var i = 1; i < arguments.length; i++) {
            arr.push('arguments[' + i + ']');
        }
        var result = eval('obj.funb(' + arr.join(',') + ')')
        delete obj.funb
        return result
    }
    aa.funa('aaaa', 10)                // åŸç”Ÿï¼šaaa, aaaa, 10
    funb.call(aa, 'bbbb', 20)          // call: aaa, bbbb, 20
    funb.callfun(aa, 'call', 20)       // call: aaa, call, 20

    // ç”¨åŸç”Ÿjså®ç°apply
    Function.prototype.applyfun = function (obj, arr) {
        var obj = obj || window
        obj.funb = this
        var newArr = []
        for(var i = 0; i < arr.length; i++) {
            newArr.push('arr[' + i + ']')
        }
        var result = eval('obj.funb(' + newArr.join(',') + ')')
        delete obj.funb
        return result
    }
    funb.applyfun(aa, ['apply', 20])

    // ç”¨åŸç”Ÿjså®ç°bind

    // Function.prototype.bindfun = function(that){
    //     var _this = this,
    //         slice = Array.prototype.slice,
    //         args = slice.apply(arguments,[1]),
    //         fNOP = function () {},
    //         bound = function(){
    //             //è¿™é‡Œçš„thisæŒ‡çš„æ˜¯è°ƒç”¨æ—¶å€™çš„ç¯å¢ƒ
    //             return _this.apply(this instanceof  fNOP ?ã€€this : that||window,
    //                 args.concat(Array.prototype.slice.apply(arguments,[0]))
    //             )
    //         } 
    //         var aa = args.concat(Array.prototype.slice.apply(arguments,[0]))
    //         console.log(aa)   
    //     fNOP.prototype = _this.prototype;
    
    //     bound.prototype = new fNOP();
    
    //     return bound;
    // }

    Function.prototype.bindfun = function () {
        var obj = arguments[0]
        var arr = []
        for (var i = 1; i < arguments.length; i++) {
            arr.push(arguments[i])
        }
        var _this = this
        var bound = function () {
            return _this.apply(obj || window, arr)
        }
        return bound
    }
    // funb.bindfun(aa)('bind', 30)    // æ­¤ç§ä¸é€‚ç”¨ ğŸ˜‚
    funb.bindfun(aa, 'bind', 30)()
</script>
</html>